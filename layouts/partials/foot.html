{{ if .Site.Params.katex }}
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      if (typeof renderMathInElement !== "function") return;
      renderMathInElement(document.body, {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "$",  right: "$",  display: false }
        ],
        throwOnError: false
      });
    });
  </script>
{{ end }}

{{ if .Site.Params.mermaid }}
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      if (!window.mermaid) return;

      // 把```mermaid 代码块替换成 <div class="mermaid">...</div>
      document.querySelectorAll("pre > code.language-mermaid").forEach((code) => {
        const pre = code.parentElement;
        const div = document.createElement("div");
        div.className = "mermaid";
        div.textContent = code.textContent;
        pre.replaceWith(div);
      });

      mermaid.initialize({
        startOnLoad: true,
        theme: "neutral"
      });
    });
  </script>
{{ end }}
